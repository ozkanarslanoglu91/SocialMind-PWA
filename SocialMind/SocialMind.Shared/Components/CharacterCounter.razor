@using SocialMind.Shared.Models

<div class="character-counter">
    <div class="counter-header">
        <span class="platform-name">@Platform.ToString()</span>
        <span class="counter-text @GetCounterClass()">
            @CurrentCount / @MaxCharacters
        </span>
    </div>
    <div class="counter-bar">
        <div class="counter-progress" style="width: @GetProgressPercentage()%; background-color: @GetProgressColor()"></div>
    </div>
    @if (IsOverLimit)
    {
        <div class="warning-message">
            ⚠️ Karakter limiti aşıldı! @(CurrentCount - MaxCharacters) karakter kısaltın.
        </div>
    }
    else if (IsNearLimit)
    {
        <div class="info-message">
            ℹ️ Karakter limitine yaklaşıyorsunuz.
        </div>
    }
</div>

<style>
    .character-counter {
        margin: 0.5rem 0;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 0.5rem;
    }
    
    .counter-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .platform-name {
        font-weight: 600;
        font-size: 0.875rem;
        color: #374151;
    }
    
    .counter-text {
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .counter-text.normal {
        color: #059669;
    }
    
    .counter-text.warning {
        color: #f59e0b;
    }
    
    .counter-text.danger {
        color: #dc2626;
    }
    
    .counter-bar {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
    }
    
    .counter-progress {
        height: 100%;
        transition: width 0.3s, background-color 0.3s;
    }
    
    .warning-message {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: #fef2f2;
        border-left: 3px solid #dc2626;
        font-size: 0.875rem;
        color: #dc2626;
    }
    
    .info-message {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: #fffbeb;
        border-left: 3px solid #f59e0b;
        font-size: 0.875rem;
        color: #f59e0b;
    }
</style>

@code {
    [Parameter]
    public SocialPlatform Platform { get; set; }
    
    [Parameter]
    public string Content { get; set; } = string.Empty;
    
    private int MaxCharacters => PlatformRegistry.GetMaxCharacterLimit(Platform);
    private int CurrentCount => Content?.Length ?? 0;
    private bool IsOverLimit => CurrentCount > MaxCharacters;
    private bool IsNearLimit => CurrentCount > MaxCharacters * 0.9 && !IsOverLimit;
    
    private string GetCounterClass()
    {
        if (IsOverLimit) return "danger";
        if (IsNearLimit) return "warning";
        return "normal";
    }
    
    private double GetProgressPercentage()
    {
        if (MaxCharacters == 0) return 0;
        var percentage = (double)CurrentCount / MaxCharacters * 100;
        return Math.Min(percentage, 100);
    }
    
    private string GetProgressColor()
    {
        if (IsOverLimit) return "#dc2626";
        if (IsNearLimit) return "#f59e0b";
        return "#059669";
    }
}
